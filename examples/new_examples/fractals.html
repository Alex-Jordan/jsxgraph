<!DOCTYPE html>
<html>
<head>
    <title>JSXGraph example</title>

    <!-- JSXGraph -->
    <link rel="stylesheet" type="text/css" href="../../distrib/jsxgraph.css" />
    <link rel="stylesheet" type="text/css" href="css/dark.css" />
    <script type="text/javascript" src="../../src/loadjsxgraph.js"></script>

    <!-- jQuery -->
    <script type="text/javascript" src="../../distrib/jquery.min.js"></script>

    <!-- Syntax Highlighting -->
    <link rel="stylesheet" type="text/css" href="css/shCore.css" />
    <link rel="stylesheet" type="text/css" href="css/shThemeDark.css" />
    <script type="text/javascript" src="js/shCore.js"></script>
    <script type="text/javascript" src="js/shBrushJScript.js"></script>
</head>

<body>

<img src="img/logo-darker.png" id="watermark" />

<div id="header">
    <!--powered by<br /-->
    <span id="jsxgraph-head"><a href="http://jsxgraph.org/"><img src="img/logo-grayscale.png" alt="JSXGraph" /></a></span>
</div>

<div id="title">
    <ul id="menu">
        <li id="menu-title"><h2><a href="javascript:void(0);" id="head-construction">Fractals</a></h2></li>
        <li id="menu-info"><h2><a href="javascript:void(0);" id="head-explanation">Info</a></h2></li>
        <li id="menu-source"><h2><a href="javascript:void(0);" id="head-source">Source</a></h2></li>
    </ul>
</div>

<div id="container" class="content-block">
    <center>
    <div id="construction">
        <div id="control" style="width: 300px; height: 300px; float: left; text-align: left;">
            <div id="controlroom" class="jxgbox" style="width: 300px; height: 300px; float: left;"></div>
            <button id="add" onclick="alert('add');">Add</button>
            <button id="rm" onclick="alert('remove');">Remove</button>
            <button id="draw">Draw</button></div>
        </div>
        <div id="jxgbox" class="jxgbox" style="width: 550px; height: 550px;"></div>
    </div>
    </center>

<script type="text/javascript" src="js/jsxgraph-dark.js">
</script>

<script id="jxg" type="text/javascript">

    (function() {
        var i,

            // control room
            control = JXG.JSXGraph.initBoard('controlroom', {boundingbox: [-7, 7, 7, -7], axis: false, grid: false}),
            cpoint = {
                withLabel: false
            },
            cp = [],

            csegment = {
                withLabel: false
            },
            cs = [],

            // fractal view
            board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-275, 275, 275, -275], axis: false, grid: false}),
            t = board.create('turtle'),

            draw = function (lvl) {
                var lengths = [], tlength, angles = [], fun;

                // reset turtle
                t.cs();
                t.hideTurtle();
                t.setPos(-250,0);
                t.rt(90);

                // calculate each segments length and the angles

                angles.push(Math.atan(cs[0].getSlope())*57.295779513082323);

                for (i = 0; i < cp.length - 1; i++) {
                    lengths.push(cp[i].Dist(cp[i+1]));

                    if (i !== cp.length - 2) {
                        angles.push(JXG.Math.Geometry.trueAngle(cp[i], cp[i+1], cp[i+2]) - 180);
                    } else {
                        angles.push(Math.atan(cs[0].getSlope())*57.295779513082323);
                    }
                }
                //tlength = JXG.Math.Statistics.sum(lengths);
                tlength = cp[0].Dist(cp[cp.length-1]);

                JXG.debug(angles, lengths);

                // compile control room configuration
                fun = function (x, lvl) {
                    var i;
                    if (lvl < 1) {
                        t.fd(x);
                    } else {
                        t.lt(angles[0]);
                        for (i = 0; i < cp.length - 1; i++) {
                            fun(lengths[i]/tlength*x, lvl-1);

//                            if (i !== cp.length - 2) {
                                t.lt(angles[i+1]);
//                            }
                        }
                    }
                };

                fun(500, lvl);
            };

        // initialize control room, example: koch curve
        /* koch curve*/
        cp.push(control.create('point', [-6, 0], cpoint));
        cp.push(control.create('point', [-2, 0], cpoint));
        cp.push(control.create('point', [ 0, Math.sqrt(12)], cpoint));
        cp.push(control.create('point', [ 2, 0], cpoint));
        cp.push(control.create('point', [ 6, 0], cpoint));
        
        
        /* something
        cp.push(control.create('point', [-6, 0], cpoint));
        cp.push(control.create('point', [-3, 2], cpoint));
        cp.push(control.create('point', [ 0, 0], cpoint));
        cp.push(control.create('point', [ 3, 2], cpoint));
        cp.push(control.create('point', [ 6, 0], cpoint));
        */
        /* sierpinski
        cp.push(control.create('point', [-6, 0], cpoint));
        cp.push(control.create('point', [ 0, 0], cpoint));
        cp.push(control.create('point', [-3, 4.5], cpoint));
        cp.push(control.create('point', [ 3, 4.5], cpoint));
        cp.push(control.create('point', [ 0, 0], cpoint));
        cp.push(control.create('point', [ 6, 0], cpoint));
        */


        for (i = 0; i < cp.length - 1; i++) {
            cs.push(control.create('segment', [cp[i], cp[i+1]], csegment));
        }

        // initialize turtle
        t.cs();
        t.hideTurtle();
        t.setPos(-250, 0 + cp[0]/6*500);
        t.rt(90);

        // initialize ui
        $('#draw').click(function () {
            board.suspendUpdate();
            draw(4);
            board.unsuspendUpdate();
        });

    })();
</script>
</div>

<div id="explanation" class="content-block">

</div>


<div id="source" class="content-block">
    <script id="jxgsource" type="syntaxhighlighter" class="brush: js"></script>
</div>

<div id="footer">
    JSXGraph is licensed under <a href="http://www.gnu.org/licenses/lgpl.txt">LGPL</a>; &copy; 2008-2011 <a href="http://jsxgraph.uni-bayreuth.de/wp/documentation/the-team/">JSXGraph Team</a>
</div>


<script type="text/javascript">
    // <![CDATA[

    $(document).ready(function() {
        var parts = {
                construction: 'show',
                source: 'hide',
                explanation: 'hide'
            },
            part;

        $('#jxgsource').text($('#jxg').text());
        SyntaxHighlighter.all();

        for(part in parts) {
            $('#' + part)[parts[part]]();

            $('#head-'+part).click(function(_part) {
                return function() {
                    var p;
                    for(p in parts) {
                        $('#' + p).hide();
                    }

                    $('#'+_part).show();
                }
            }(part));
        }
    });

    // ]]>
</script>
</body>
</html>
