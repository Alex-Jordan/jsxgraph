<html>
<head>
   <title>JSXGraph example</title>
   <link rel="stylesheet" type="text/css" href="../distrib/jsxgraph.css" />
   <script type="text/javascript" src="../src/loadjsxgraph.js"></script>
</head>
<body>
  <h2>B-splines</h2>
  <div id="jxgbox" class="jxgbox" style="width:600px; height:600px;"></div>
  <div id="debug" style="display:block;"></div>
   <script type="text/javascript">
    /* <![CDATA[ */
    (function(){
        var board, i, p, col;
        board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox:[-4,4,4,-4], keepaspectratio:true, axis:true});
        //board.options.curve.doAdvancedPlot = false;
        p = [];
        for (i=0;i<6;i++) {
            if (i%1==0) {
                col = 'red';
            } else {
                col = 'blue';
            }
            p.push(board.createElement('point',[Math.random()*8-4,Math.random()*8-4],{strokeColor:col,fillColor:col}));
        }
        
        var knotVector = function(n,k){
                var j, t = [];
                for (j=0;j<n+k+1;j++) {
                    if (j<k) {
                        t[j] = 0.0;
                    } else if (j<=n) {
                        t[j] = j-k+1;
                    } else {
                        t[j] = n-k+2;
                    }
                }
                return t;
            };
        
        var evalBasisFuncs = function(x,t,n,k,s) {
                var i,j,s,a,b,den,
                    N = [];
                    
                if (t[s]<=x && x<t[s+1]) {
                    N[s]=1; 
                } else {
                    N[s]=0; 
                }
                for (i=2;i<=k;i++) {
                    for (j=s-i+1;j<=s;j++) {
                        if (j<=s-i+1||j<0) {
                            a = 0.0;
                        } else {
                            a = N[j];
                        }
                        if (j>=s) {
                            b = 0.0;
                        } else {
                            b = N[j+1];
                        }
                        den = t[j+i-1]-t[j];
                        if (den==0) {
                            N[j] = 0;
                        } else {
                            N[j] = (x-t[j])/den*a;
                        }
                        den = t[j+i]-t[j+1];
                        if (den!=0) {
                            N[j] += (t[j+i]-x)/den*b;
                        }
                    }
                }    
                return N;
            };
        
        var bspline = [function(x) {
                        var len = p.length, 
                            y,i, j, s, a, b,t,N,
                            n = len-1,
                            k = 4;
                            
                        if (n<=0) return NaN;
                        if (n+2<=k) k = n+1;
                        if (x<=0) return p[0].X(); 
                        if (x>=n-k+2) return p[n].X();

                        t = knotVector(n,k);
                        s = Math.floor(x)+k-1;
                        N = evalBasisFuncs(x,t,n,k,s);
                        
                        y = 0.0;
                        for (j=s-k+1;j<=s;j++) {
                            if (j<len && j>=0) y += p[j].X()*N[j];
                        }
                        return y;
                    },
                    function(x) {
                        var len = p.length, 
                            y,i, j, s, a, b,t,N,
                            n = len-1,
                            k = 4;

                        if (n<=0) return NaN;
                        if (n+2<=k) k = n+1;
                        if (x<=0) return p[0].Y();
                        if (x>=n-k+2) return p[n].Y();
                        
                        t = knotVector(n,k);
                        s = Math.floor(x)+k-1;
                        N = evalBasisFuncs(x,t,n,k,s);

                        y = 0.0;
                        for (j=s-k+1;j<=s;j++) {
                            if (j<len && j>=0) y += p[j].Y()*N[j];
                        }
                        return y;
                    }, 0, function(){return p.length-1;}];
                    
        var c = board.createElement('curve', bspline, {strokecolor:'blue', strokeWidth:2}); 
        })();
        
  /* ]]> */
  </script>
</body>
</html>
